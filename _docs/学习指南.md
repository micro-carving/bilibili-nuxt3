# Nuxt3 - 哔哩哔哩 - 项目实战

## 简介

**Nuxt 框架**提供了一种基于 Node.js 的**服务端渲染方案 SSR（Server
SideRendering）**，可以让 Vue 应用在服务器端进行渲染，从而提高页面的加载速度和
SEO。

## 项目预览

### 在线预览

https://bilibili.megasu.top/

https://nuxt3-bilibili.vercel.app/ (备用)

### 扫码预览

<img src="./_assets/qrcode.png" width="200" />

### 项目截图

![项目预览](./_assets/preview.png)

### 收获

**完成带数据交互的 哔哩哔哩移动端 项目**，包括以下知识点的实战应用。

- SEO 优化
- 基于文件的路由系统
- 自动导入
- Nuxt DevTools 调试工具
- 自定义组件
- `@vant/nuxt` 组件库
- 移动端 `vw` 适配
- 接口服务器
- 数据获取
- 分页加载
- 动态路由传参
- 项目打包上线

## 演示环境

- **电脑系统** - Windows 10
- **开发工具** - VS Code (需安装 Vue - Official 扩展插件)
- **Node.js** - v18.18.2
- **pnpm** - 8.11.0
- **Nuxt** - 3.12.4
- **Vue** - 3.4.33

## 创建 Nuxt3 项目

[Nuxt 官网](https://nuxt.com/) https://nuxt.com/

### 初始化命令

```sh
npx nuxi init <project-name>
```

其中 `<project-name>` 换成自己的项目名称。

**下载问题**

由于国内访问受限，通过命令行下载可能会失败。

解决方案参考：**修改 host 文件**

**Windows 系统**

```sh
C:\Windows\System32\drivers\etc

# 增加以下代码
185.199.108.133 raw.githubusercontent.com
```

映射关系为访问 `raw.githubusercontent.com` 映射到 IP 地址 `185.199.108.133`。

**Mac 系统**

参考链接：

- [Windows 修改 hosts](https://zhuanlan.zhihu.com/p/563171304)
- [Mac 修改 hosts](https://zhuanlan.zhihu.com/p/461884595)
- [手动下载地址](https://github.com/nuxt/starter/tree/v3)

### 运行项目

1. 进入项目目录，并安装项目依赖 `npm install`。
2. 启动项目，`npm run dev`。
3. ✨ 浏览器访问 [http://localhost:3000](http://127.0.0.1:3000/)

### 服务端渲染

**SPA 和 SSR 是什么**

- **SPA（Single Page Application）** 单页面应用，在**客户端**通过 JS 动态地构建
  页面。
- **SSR（Server-Side Rendering）** 服务器端渲染，在**服务器端**生成 HTML 页面并
  发送给客户端。

**有什么不同？**

- **SPA** 的特点是页面切换流畅，动态渲染变化的部分，**用户体验好**，但是对搜索引
  擎的支持不够友好。
- **SSR** 的特点是对搜索引擎友好，可以提高页面**首次加载速度** 和 **SEO**，但是
  页面切换可能不够流畅，因为每次都是请求一个完整的 `HTML` 页面。

**Nuxt 框架优势**

- Nuxt 采用了**混合的架构模式**，同时支持 **SSR** 和 **SPA**。
- **SSR** 服务端渲染： 首次访问页面 ，`Nuxt.js` 在服务器端执行 `Vue` 组件的渲染
  过程，并生成初始 HTML。
- **SPA** 客户端激活：一旦初始 `HTML` 被发送到浏览器，`Vue.js` 会接管页面，后续
  的页面切换则使用 **SPA** 的方式进行。
- `Nuxt` 框架优势：**兼顾了 SSR 和 SPA 的优点**。

**适用场景**

企业网站、商品展示 等 C 端网站，对 **SEO** 搜索更友好，且页面切换流畅，用户体验
更好。

**开启或关闭服务端渲染**

`Nuxt` 默认开启 **SSR** 服务端渲染，推荐开启，从而兼顾了 **SSR** 和 **SPA** 的优
点，也利于 **SEO** 搜索引擎优化。

```ts
// nuxt.config.ts
export default defineNuxtConfig({
	// 是否开启 ssr 服务端渲染
	ssr: true,
});
```

## 路由案例

### 目录结构

我们先来认识 `Nuxt3` 项目的目录结构。

```sh
├─.nuxt              非工程代码，存放运行或发行的编译结果
├─node_modules       项目依赖
├─public             网站资源目录
├─server             接口服务器目录
├─.gitignore         git 忽略文件
├─.npmrc             npm 配置文件
├─app.vue            根组件
├─nuxt.config.ts     nuxt 配置文件
├─package.json       项目配置文件
├─README.md          项目说明文件
└─tsconfig.json      ts 配置文件
```

### 案例练习

`Nuxt` 有一些**约定的目录**，有特殊功能，如 **pages** 目录的 `vue` 文件会自动注
册路由。

```sh
├─ pages             页面目录，自动注册路由
```

`Nuxt` 自带基于文件的路由系统，无需安装 **vue-router**，无需额外配置。

**参考目录**

```sh
├─ pages                   页面目录，自动注册路由
│  └─index/index.vue       主页
│  └─video/index.vue       视频页
└─app.vue                  根组件
```

**参考代码**

```vue
<template>
	<!-- 路由链接 -->
	<NuxtLink to="/">首页</NuxtLink>
	<NuxtLink to="/video">视频页</NuxtLink>
	<!-- 页面路由 -->
	<NuxtPage />
</template>
```

- 页面路由 `<NuxtPage>` 相当于 `<RouterView>`
- 页面跳转 `<NuxtLink>` 相当于 `<RouterLink>`

## 项目实战 - Nuxt 版哔哩哔哩

### 项目资料

- [在线体验](https://bilibili.megasu.top/)
- [参考代码](https://gitee.com/Megasu/nuxt-bilibili)

## SEO 优化

通过设置网页 `title` 和 `description` 等 **SEO** 优化信息，由服务端渲染，可提高
网页在搜索引擎结果页面中的排名和可见性 。

```vue
<script setup lang="ts">
// SEO 优化信息
useSeoMeta({
	// 网站标题
	title: "哔哩哔哩 (゜-゜)つロ 干杯~-bilibili",
	// 网站描述
	description:
		"bilibili是国内知名的在线视频弹幕网站，拥有最棒的ACG氛围，哔哩哔哩内容丰富多元，涵盖动漫、电影、二次元舞蹈视频、在线音乐、娱乐时尚、科技生活、鬼畜视频等。下载客户端还可离线下载电影、动漫。",
	// 搜索关键词
	keywords: "B站,bilibili,哔哩哔哩,哔哩哔哩动画,动漫,电影,在线动漫,高清电影",
});
</script>
```

参考链接：

- [SEO 和 Meta](https://nuxt.com/docs/getting-started/seo-meta#seo-and-meta)

## `@vant/nuxt` 组件库

### 按照和配置

- 安装 `nuxt` 版 `vant-ui`

```sh
pnpm add -D @vant/nuxt
```

- 添加配置

```ts
// nuxt.config.ts
export default defineNuxtConfig({
	// 调试工具
	devtools: { enabled: true },
	// 应用模块
	modules: ["@vant/nuxt"],
});
```

- 使用

```vue
<van-button type="primary">主要按钮</van-button>
<van-button type="info">信息按钮</van-button>
```

PS： 在 Nuxt 项目中，vant 组件会自动按需导入（需重启服务）。

### 修改主题色

在 app.vue 的样式全局生效。

```vue
<style lang="scss">
/* vant-ui 主题定制 */
:root {
	--van-primary-color: #fb7299;
	--van-back-top-background: #fbfbfb;
	--van-back-top-text-color: #666;
}
</style>
```

**参考链接**

- [vant-nuxt](https://github.com/vant-ui/vant-nuxt)
- [vant 样式变量](https://vant-ui.github.io/vant/#/zh-CN/config-provider#bian-liang-lie-biao)

## 项目中的 vw 适配

**安装依赖**

```sh
pnpm add -D postcss-px-to-viewport
```

**添加配置**

```ts
// nuxt.config.ts
export default defineNuxtConfig({
	// ...省略
	// 移动端适配
	postcss: {
		plugins: {
			"postcss-px-to-viewport": {
				viewportWidth: 375,
			},
		},
	},
});
```

参考文档：

- [nuxt 配置 - postcss](https://nuxt.com/docs/api/nuxt-config#postcss)
- [vant 进阶用法 - postcss](https://vant-ui.github.io/vant/#/zh-CN/advanced-usage#liu-lan-qi-gua-pei)

## 哔哩哔哩首页

### 素材和样式准备

拷贝素材中的 `assets` 目录项目中，包含项目所需的图片、基础样式、字体图标。

下载安装 `sass`

```sh
pnpm add -D sass
```

项目中导入基础样式和字体图标。

```vue
<style lang="scss">
// 基础样式
@import "./assets/styles/base.scss";
// 字体图标
@import "./assets/styles/iconfont.scss";
</style>
```
